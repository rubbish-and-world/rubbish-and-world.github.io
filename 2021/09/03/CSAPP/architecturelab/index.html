<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>architecturelab | RainbowBin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="Architecture lab">
<meta property="og:type" content="article">
<meta property="og:title" content="architecturelab">
<meta property="og:url" content="http://rubbish-and-world.github.io/2021/09/03/CSAPP/architecturelab/index.html">
<meta property="og:site_name" content="RainbowBin">
<meta property="og:description" content="Architecture lab">
<meta property="og:locale">
<meta property="article:published_time" content="2021-09-03T07:36:00.000Z">
<meta property="article:modified_time" content="2021-09-04T06:33:17.259Z">
<meta property="article:author" content="rubbish">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="RainbowBin" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">RainbowBin</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://rubbish-and-world.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-CSAPP/architecturelab" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2021/09/03/CSAPP/architecturelab/" class="article-date">
  <time class="dt-published" datetime="2021-09-03T07:36:00.000Z" itemprop="datePublished">2021-09-03</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/csapp/">csapp</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      architecturelab
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Architecture-lab"><a href="#Architecture-lab" class="headerlink" title="Architecture lab"></a>Architecture lab</h1><a id="more"></a>

<h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>The lab is organized into three parts, each with its own handin</p>
<ul>
<li>In Part A you will write some simple Y86-64 programs and become familiar with the Y86-64 tools.</li>
<li>In Part B, you will extend the SEQ simulator with a new instruction. </li>
<li>These two parts will prepare you for Part C, the heart of the lab, where you will optimize the Y86-64 benchmark program and the processor design.</li>
</ul>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ tar xvf archlab-handout.tar</span><br><span class="line">$ cat README</span><br><span class="line">This directory contains the files that you need <span class="keyword">for</span> the CS:APP</span><br><span class="line">architecture lab.</span><br><span class="line"></span><br><span class="line">******</span><br><span class="line">Files:</span><br><span class="line">******</span><br><span class="line"></span><br><span class="line">Makefile		Use this to handin your solutions</span><br><span class="line">README			This file</span><br><span class="line">archlab.&#123;ps,pdf&#125;	Lab writeup</span><br><span class="line">sim.tar			Archive of the Y86-64 tools <span class="keyword">in</span> tar format</span><br><span class="line">simguide.&#123;ps,pdf&#125;	CS:APP Guide to Simulators document</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ tar xvf sim.tar</span><br><span class="line">$ <span class="built_in">cd</span> sim</span><br><span class="line">$ make clean; make <span class="comment"># for GUI version</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ vim Makefile</span><br><span class="line"><span class="comment"># comment out TKLIBS and TKINC for non-GUI version</span></span><br><span class="line">$ make clean; make</span><br></pre></td></tr></table></figure>
<h2 id="PartA"><a href="#PartA" class="headerlink" title="PartA"></a>PartA</h2><p><em>You will be working in directory <code>sim/misc</code> in this part.</em></p>
<p>Your task is to write and simulate the following three Y86-64 programs.</p>
<ul>
<li>put your name and ID in a comment at the beginning of each program</li>
<li>You can test your programs by first assemblying them with the program <code>YAS</code> and then running them with the instruction set simulator <code>YIS</code>.</li>
<li>you should follow the x86-64 conventions for passing function arguments, using registers, and using the stack. This includes saving and restoring any callee-save registers that you use.</li>
<li>The C code of the program is in <code>sim/misc/example.c</code></li>
</ul>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* </span></span><br><span class="line"><span class="comment"> * Architecture Lab: Part A </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * High level specs for the functions that the students will rewrite</span></span><br><span class="line"><span class="comment"> * in Y86-64 assembly language</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* $begin examples */</span></span><br><span class="line"><span class="comment">/* linked list element */</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">ELE</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> val;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">ELE</span> *<span class="title">next</span>;</span></span><br><span class="line">&#125; *list_ptr;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* sum_list - Sum the elements of a linked list */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">sum_list</span><span class="params">(list_ptr ls)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> val = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (ls) &#123;</span><br><span class="line">	val += ls-&gt;val;</span><br><span class="line">	ls = ls-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> val;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* rsum_list - Recursive version of sum_list */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">rsum_list</span><span class="params">(list_ptr ls)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (!ls)</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">	<span class="keyword">long</span> val = ls-&gt;val;</span><br><span class="line">	<span class="keyword">long</span> rest = rsum_list(ls-&gt;next);</span><br><span class="line">	<span class="keyword">return</span> val + rest;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* copy_block - Copy src to dest and return xor checksum of src */</span></span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="title">copy_block</span><span class="params">(<span class="keyword">long</span> *src, <span class="keyword">long</span> *dest, <span class="keyword">long</span> len)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">long</span> result = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (len &gt; <span class="number">0</span>) &#123;</span><br><span class="line">	<span class="keyword">long</span> val = *src++;</span><br><span class="line">	*dest++ = val;</span><br><span class="line">	result ^= val;</span><br><span class="line">	len--;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* $end examples */</span></span><br></pre></td></tr></table></figure>
<h5 id="Program-1"><a href="#Program-1" class="headerlink" title="Program 1"></a>Program 1</h5><p><code>sum.ys</code>: Iteratively sum linked list elements</p>
<p>Your program should consist of some code that <strong>sets up the stack structure, invokes a function, and then halts</strong></p>
<p>Test your program using the following three-element list:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># Sample linked list </span><br><span class="line">.align 8</span><br><span class="line">ele1:</span><br><span class="line">	.quad 0x00a </span><br><span class="line">	.quad ele2</span><br><span class="line">ele2:</span><br><span class="line">	.quad 0x0b0 </span><br><span class="line">	.quad ele3</span><br><span class="line">ele3:</span><br><span class="line">	.quad 0xc00 </span><br><span class="line">	.quad 0</span><br></pre></td></tr></table></figure>
<h4 id="My-solution"><a href="#My-solution" class="headerlink" title="My solution :"></a>My solution :</h4><ol>
<li><p>use <code>.pos 0xvalue</code> to specify the address in code section</p>
</li>
<li><p>I know we can use <code>gcc</code> to first assemble <code>example.c</code> into <code>x86_64</code> assembly code and then modify it to y86 code, but just not recommended.</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># code section start at address 0x0</span><br><span class="line">    .pos 0</span><br><span class="line">code:</span><br><span class="line"># stack set up</span><br><span class="line">irmovq stack, %rsp</span><br><span class="line"></span><br><span class="line"># entry of the program</span><br><span class="line">main:</span><br><span class="line">    irmovq data,%rdi</span><br><span class="line">    call sum_list</span><br><span class="line">    halt</span><br><span class="line"></span><br><span class="line"># sum_list(Node * ls)</span><br><span class="line">sum_list:</span><br><span class="line">    # initialize return value to 0</span><br><span class="line">    irmovq $0 , %rax</span><br><span class="line">    # test if ls is NULL</span><br><span class="line">    irmovq $0 , %rbx</span><br><span class="line">    subq %rbx, %rdi</span><br><span class="line">    je return</span><br><span class="line">    # guarded do strategy</span><br><span class="line">loop:</span><br><span class="line">    mrmovq (%rdi),%rsi</span><br><span class="line">    addq %rsi,%rax</span><br><span class="line">    mrmovq 8(%rdi),%rdi</span><br><span class="line">    subq %rbx , %rdi</span><br><span class="line">    jne loop</span><br><span class="line">return:</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line"># Sample linked list </span><br><span class="line"># data section start at address 0x300</span><br><span class="line">.pos 0x300</span><br><span class="line">.align 8</span><br><span class="line">data:</span><br><span class="line">ele1:</span><br><span class="line">	.quad 0x00a </span><br><span class="line">	.quad ele2</span><br><span class="line">ele2:</span><br><span class="line">	.quad 0x0b0 </span><br><span class="line">	.quad ele3</span><br><span class="line">ele3:</span><br><span class="line">	.quad 0xc00 </span><br><span class="line">	.quad 0</span><br><span class="line"></span><br><span class="line"># stack grows from address 0x500 to 0x0 (should be limited at 0x300)</span><br><span class="line">    .pos 0x500</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Stopped in 24 steps at PC &#x3D; 0x1d.  Status &#39;HLT&#39;, CC Z&#x3D;1 S&#x3D;0 O&#x3D;0</span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:	0x0000000000000000	0x0000000000000cba</span><br><span class="line">%rsp:	0x0000000000000000	0x0000000000000500</span><br><span class="line">%rsi:	0x0000000000000000	0x0000000000000c00</span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line">0x04f8:	0x0000000000000000	0x000000000000001d</span><br></pre></td></tr></table></figure>
<h4 id="Program-2"><a href="#Program-2" class="headerlink" title="Program 2"></a>Program 2</h4><p><code>rsum.ys</code>: Recursively sum linked list elements</p>
<p>This code should be similar to the code in <code>sum.ys</code>, except that it should use a function <code>rsum_list</code> that recursively sums a list of numbers, as shown with the C function <code>rsum_list</code></p>
<h4 id="My-solution-1"><a href="#My-solution-1" class="headerlink" title="My solution:"></a>My solution:</h4><p>when using callee saved register in recursive function:</p>
<ol>
<li><code>push</code> it before use it</li>
<li><code>pop</code> it after use it</li>
<li>if not used in some branch, not <code>push</code> and <code>pop</code> are needed at all.</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># code section start at address 0x0</span><br><span class="line">    .pos 0</span><br><span class="line">code:</span><br><span class="line"></span><br><span class="line"># stack set up</span><br><span class="line">irmovq stack, %rsp</span><br><span class="line"></span><br><span class="line"># entry of the program</span><br><span class="line">main:</span><br><span class="line">    irmovq data,%rdi</span><br><span class="line">    call rsum_list</span><br><span class="line">    halt</span><br><span class="line"></span><br><span class="line"># rsum_list(Node * ls)</span><br><span class="line">rsum_list:</span><br><span class="line">    irmovq $0 , %rax # initialize return value to 0</span><br><span class="line">    irmovq $0 , %rcx # get a 0 constant</span><br><span class="line">    subq %rcx , %rdi</span><br><span class="line">    je return</span><br><span class="line"># else:</span><br><span class="line">    pushq %rbp</span><br><span class="line">    mrmovq (%rdi),%rsi</span><br><span class="line">    addq %rsi, %rax</span><br><span class="line">    rrmovq %rax, %rbp</span><br><span class="line">    mrmovq 8(%rdi),%rdi</span><br><span class="line">    call rsum_list</span><br><span class="line">    addq %rbp ,%rax </span><br><span class="line">    popq %rbp</span><br><span class="line">return:</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line"># Sample linked list </span><br><span class="line"># data section start at address 0x300</span><br><span class="line">.pos 0x300</span><br><span class="line">.align 8</span><br><span class="line">data:</span><br><span class="line">ele1:</span><br><span class="line">	.quad 0x00a </span><br><span class="line">	.quad ele2</span><br><span class="line">ele2:</span><br><span class="line">	.quad 0x0b0 </span><br><span class="line">	.quad ele3</span><br><span class="line">ele3:</span><br><span class="line">	.quad 0xc00 </span><br><span class="line">	.quad 0</span><br><span class="line"># stack grows from address 0x500 to 0x0 (should be limited at 0x300)</span><br><span class="line">    .pos 0x500</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Stopped in 48 steps at PC &#x3D; 0x1d.  Status &#39;HLT&#39;, CC Z&#x3D;0 S&#x3D;0 O&#x3D;0</span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:	0x0000000000000000	0x0000000000000cba</span><br><span class="line">%rsp:	0x0000000000000000	0x0000000000000500</span><br><span class="line">%rsi:	0x0000000000000000	0x0000000000000c00</span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line">0x04c8:	0x0000000000000000	0x0000000000000060</span><br><span class="line">0x04d0:	0x0000000000000000	0x00000000000000b0</span><br><span class="line">0x04d8:	0x0000000000000000	0x0000000000000060</span><br><span class="line">0x04e0:	0x0000000000000000	0x000000000000000a</span><br><span class="line">0x04e8:	0x0000000000000000	0x0000000000000060</span><br><span class="line">0x04f8:	0x0000000000000000	0x000000000000001d</span><br></pre></td></tr></table></figure>
<h4 id="Program-3"><a href="#Program-3" class="headerlink" title="Program 3"></a>Program 3</h4><p><code>copy.ys</code>: Copy a source block to a destination block</p>
<p>Write a program (copy.ys) that copies a block of words from one part of memory to another (non-overlapping area) area of memory, computing the checksum (Xor) of all the words copied.</p>
<p>Test your program using the following three-element source and destination blocks:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.align 8</span><br><span class="line"># Source block src:</span><br><span class="line">.quad 0x00a .quad 0x0b0 .quad 0xc00</span><br><span class="line"># Destination block</span><br><span class="line">dest:</span><br><span class="line">.quad 0x111 .quad 0x222 .quad 0x333</span><br></pre></td></tr></table></figure>
<h4 id="My-solution-2"><a href="#My-solution-2" class="headerlink" title="My solution :"></a>My solution :</h4><p>Note that in y86 address is assigned by lines</p>
<p>So <code>quad 0x00a .quad 0x0b0 .quad 0xc00</code> and</p>
<p><code>.quad 0x00a  .quad 0x0b0  .quad 0xc00</code></p>
<p>are different.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"># code section start at address 0x0</span><br><span class="line">    .pos 0</span><br><span class="line">code:</span><br><span class="line"></span><br><span class="line"># stack set up</span><br><span class="line">irmovq stack, %rsp</span><br><span class="line"></span><br><span class="line"># entry of the program</span><br><span class="line">main:</span><br><span class="line">    irmovq src,%rdi</span><br><span class="line">    irmovq dest,%rsi</span><br><span class="line">    irmovq $3, %rcx</span><br><span class="line">    call copy_block</span><br><span class="line">    halt</span><br><span class="line"></span><br><span class="line">copy_block:</span><br><span class="line">    # initialize return value to 0</span><br><span class="line">    irmovq $0 , %rax</span><br><span class="line">    # set constants</span><br><span class="line">    irmovq $0, %rbp</span><br><span class="line">    irmovq $8, %rbx</span><br><span class="line">    # jump to middle strategy</span><br><span class="line">    jmp test</span><br><span class="line">loop:</span><br><span class="line">    mrmovq (%rdi),%rdx </span><br><span class="line">    addq %rbx,%rdi</span><br><span class="line">    rmmovq %rdx,(%rsi)</span><br><span class="line">    addq %rbx , %rsi</span><br><span class="line">    xorq %rdx,%rax</span><br><span class="line">    irmovq $1,%rdx</span><br><span class="line">    subq %rdx,%rcx</span><br><span class="line">test:</span><br><span class="line">    subq %rbp , %rcx</span><br><span class="line">    jg loop</span><br><span class="line">    ret</span><br><span class="line"></span><br><span class="line"># data section start at address 0x300</span><br><span class="line">.pos 0x300</span><br><span class="line">.align 8</span><br><span class="line"># Source block </span><br><span class="line">src:</span><br><span class="line">.quad 0x00a </span><br><span class="line">.quad 0x0b0 </span><br><span class="line">.quad 0xc00</span><br><span class="line"># Destination block</span><br><span class="line">dest:</span><br><span class="line">.quad 0x111 </span><br><span class="line">.quad 0x222 </span><br><span class="line">.quad 0x333</span><br><span class="line"></span><br><span class="line"># stack grows from address 0x500 to 0x0 (should be limited at 0x300)</span><br><span class="line">    .pos 0x500</span><br><span class="line">stack:</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">Stopped in 40 steps at PC &#x3D; 0x31.  Status &#39;HLT&#39;, CC Z&#x3D;1 S&#x3D;0 O&#x3D;0</span><br><span class="line">Changes to registers:</span><br><span class="line">%rax:	0x0000000000000000	0x0000000000000cba</span><br><span class="line">%rdx:	0x0000000000000000	0x0000000000000001</span><br><span class="line">%rbx:	0x0000000000000000	0x0000000000000008</span><br><span class="line">%rsp:	0x0000000000000000	0x0000000000000500</span><br><span class="line">%rsi:	0x0000000000000000	0x0000000000000330</span><br><span class="line">%rdi:	0x0000000000000000	0x0000000000000318</span><br><span class="line"></span><br><span class="line">Changes to memory:</span><br><span class="line">0x0318:	0x0000000000000111	0x000000000000000a</span><br><span class="line">0x0320:	0x0000000000000222	0x00000000000000b0</span><br><span class="line">0x0328:	0x0000000000000333	0x0000000000000c00</span><br><span class="line">0x04f8:	0x0000000000000000	0x0000000000000031</span><br></pre></td></tr></table></figure>
<h2 id="Part-B"><a href="#Part-B" class="headerlink" title="Part B"></a>Part B</h2><p>You will be working in directory <code>sim/seq</code> in this part.</p>
<p>Your task in Part B is to extend the SEQ processor to support the <code>iaddq</code></p>
<p>To add this instructions, you will modify the file <code>seq-full.hcl</code>, which implements the version of SEQ described in the CS:APP3e textbook. In addition, it contains declarations of some constants that you will need for your solution.</p>
<p>Your HCL file must begin with a header comment containing the following information:</p>
<ul>
<li>Your name and ID.</li>
<li>A description of the computations required for the <code>iaddq</code> instruction. Use the descriptions of <code>irmovq</code> and <code>OPq</code> in Figure 4.18 in the CS:APP3e text as a guide.</li>
</ul>
<h3 id="Building-and-Testing-Your-Solution"><a href="#Building-and-Testing-Your-Solution" class="headerlink" title="Building and Testing Your Solution"></a>Building and Testing Your Solution</h3><p>you will need to build a new instance of the SEQ simulator (<code>ssim</code>) based on this HCL file, and then test it</p>
<h4 id="Build"><a href="#Build" class="headerlink" title="Build"></a>Build</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make VERSION=full</span><br></pre></td></tr></table></figure>
<p>(This builds a version of <code>ssim</code> that uses the control logic you specified in <code>seq-full.hcl</code>. To save typing, you can assign <code>VERSION=full</code> in the Makefile.)</p>
<h4 id="Test"><a href="#Test" class="headerlink" title="Test"></a>Test</h4><h5 id="Testing-your-solution-on-a-simple-Y86-64-program"><a href="#Testing-your-solution-on-a-simple-Y86-64-program" class="headerlink" title="Testing your solution on a simple Y86-64 program."></a>Testing your solution on a simple Y86-64 program.</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./ssim -t ../y86-code/asumi.yo</span><br></pre></td></tr></table></figure>
<h5 id="Debug"><a href="#Debug" class="headerlink" title="Debug"></a>Debug</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./ssim -g ../y86-code/asumi.yo</span><br></pre></td></tr></table></figure>
<h5 id="Retesting-your-solution-using-the-benchmark-programs"><a href="#Retesting-your-solution-using-the-benchmark-programs" class="headerlink" title="Retesting your solution using the benchmark programs"></a>Retesting your solution using the benchmark programs</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ (<span class="built_in">cd</span> ../y86-code; make testssim)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>Note that none of these programs test the added instructions.</p>
<p> You are simply making sure that your solution did not inject errors for the original instructions. See  <code>../y86-code/README</code> file for more details.</p>
</blockquote>
<h5 id="Performing-regression-tests"><a href="#Performing-regression-tests" class="headerlink" title="Performing regression tests."></a>Performing regression tests.</h5><p><em>test everything except <code>iaddq</code> and <code>leave</code></em> </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ (<span class="built_in">cd</span> ../ptest; make SIM=../seq/ssim)</span><br></pre></td></tr></table></figure>
<p><em>test <code>iaddq</code></em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ (<span class="built_in">cd</span> ../ptest; make SIM=../seq/ssim TFLAGS=-i)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>For more information on the SEQ simulator refer to the handout <em>CS:APP3e Guide to Y86-64 Processor Simulators</em> (<code>simguide.pdf</code>).</p>
</blockquote>
<h4 id="My-solution-3"><a href="#My-solution-3" class="headerlink" title="My solution :"></a>My solution :</h4><p>The problem could have been much harder. Due to the bloody clear comments and concise codes given by the file itself, adding the <code>iaddq</code> instruction becomes a piece of cake. Just adding <code>IIADDQ</code> at serveral different places will get the job done.</p>
<p>The teachers at CMU really did a splendid job, I really appreciate their efforts and passion.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">Stage               iaddq V,rB</span><br><span class="line"></span><br><span class="line">Fetch               icode:ifunc ← M1[PC]</span><br><span class="line">                    rA:rB ← M1[PC+1]</span><br><span class="line">                    valC ← M8[PC + 2]</span><br><span class="line">                    valP &#x3D; PC + 10</span><br><span class="line">                    </span><br><span class="line">Decode              valB ← R[rB]</span><br><span class="line"></span><br><span class="line">Execute             valE ← valB + valC</span><br><span class="line"></span><br><span class="line">Memory</span><br><span class="line"></span><br><span class="line">Write back          R[rB] ← valE</span><br><span class="line"></span><br><span class="line">PC update           PC ← valP</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment">#    Control Signal Definitions.                                   #</span></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################ Fetch Stage     ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Determine instruction code</span></span><br><span class="line">word icode = [</span><br><span class="line">	imem_error: INOP;</span><br><span class="line">	<span class="number">1</span>: imem_icode;		<span class="comment"># Default: get from instruction memory</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment"># Determine instruction function</span></span><br><span class="line">word ifun = [</span><br><span class="line">	imem_error: FNONE;</span><br><span class="line">	<span class="number">1</span>: imem_ifun;		<span class="comment"># Default: get from instruction memory</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> instr_valid = icode <span class="keyword">in</span> </span><br><span class="line">	&#123; INOP, IHALT, IRRMOVQ, IIRMOVQ, IRMMOVQ, IMRMOVQ,</span><br><span class="line">	       IOPQ, IJXX, ICALL, IRET, IPUSHQ, IPOPQ , IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Does fetched instruction require a regid byte?</span></span><br><span class="line"><span class="built_in">bool</span> need_regids =</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRRMOVQ, IOPQ, IPUSHQ, IPOPQ, </span><br><span class="line">		     IIRMOVQ, IRMMOVQ, IMRMOVQ , IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Does fetched instruction require a constant word?</span></span><br><span class="line"><span class="built_in">bool</span> need_valC =</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IIRMOVQ, IRMMOVQ, IMRMOVQ, IJXX, ICALL , IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">################ Decode Stage    ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## What register should be used as the A source?</span></span><br><span class="line">word srcA = [</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRRMOVQ, IRMMOVQ, IOPQ, IPUSHQ  &#125; : rA;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IPOPQ, IRET &#125; : RRSP;</span><br><span class="line">	<span class="number">1</span> : RNONE; <span class="comment"># Don&#x27;t need register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## What register should be used as the B source?</span></span><br><span class="line">word srcB = [</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IOPQ, IRMMOVQ, IMRMOVQ   , IIADDQ &#125; : rB;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IPUSHQ, IPOPQ, ICALL, IRET &#125; : RRSP;</span><br><span class="line">	<span class="number">1</span> : RNONE;  <span class="comment"># Don&#x27;t need register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## What register should be used as the E destination?</span></span><br><span class="line">word dstE = [</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRRMOVQ &#125; &amp;&amp; Cnd : rB;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IIRMOVQ, IOPQ , IIADDQ &#125; : rB;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IPUSHQ, IPOPQ, ICALL, IRET &#125; : RRSP;</span><br><span class="line">	<span class="number">1</span> : RNONE;  <span class="comment"># Don&#x27;t write any register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## What register should be used as the M destination?</span></span><br><span class="line">word dstM = [</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IMRMOVQ, IPOPQ &#125; : rA;</span><br><span class="line">	<span class="number">1</span> : RNONE;  <span class="comment"># Don&#x27;t write any register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">################ Execute Stage   ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Select input A to ALU</span></span><br><span class="line">word aluA = [</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRRMOVQ, IOPQ &#125; : valA;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IIRMOVQ, IRMMOVQ, IMRMOVQ  , IIADDQ &#125; : valC;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; ICALL, IPUSHQ &#125; : -<span class="number">8</span>;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRET, IPOPQ &#125; : <span class="number">8</span>;</span><br><span class="line">	<span class="comment"># Other instructions don&#x27;t need ALU</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Select input B to ALU</span></span><br><span class="line">word aluB = [</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRMMOVQ, IMRMOVQ, IOPQ, ICALL, </span><br><span class="line">		      IPUSHQ, IRET, IPOPQ  ,  IIADDQ &#125; : valB;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRRMOVQ, IIRMOVQ &#125; : <span class="number">0</span>;</span><br><span class="line">	<span class="comment"># Other instructions don&#x27;t need ALU</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set the ALU function</span></span><br><span class="line">word alufun = [</span><br><span class="line">	icode == IOPQ : ifun;</span><br><span class="line">	<span class="number">1</span> : ALUADD;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Should the condition codes be updated?</span></span><br><span class="line"><span class="built_in">bool</span> set_cc = icode <span class="keyword">in</span> &#123; IOPQ , IIADDQ  &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">################ Memory Stage    ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Set read control signal</span></span><br><span class="line"><span class="built_in">bool</span> mem_read = icode <span class="keyword">in</span> &#123; IMRMOVQ, IPOPQ, IRET &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set write control signal</span></span><br><span class="line"><span class="built_in">bool</span> mem_write = icode <span class="keyword">in</span> &#123; IRMMOVQ, IPUSHQ, ICALL &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Select memory address</span></span><br><span class="line">word mem_addr = [</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRMMOVQ, IPUSHQ, ICALL, IMRMOVQ &#125; : valE;</span><br><span class="line">	icode <span class="keyword">in</span> &#123; IPOPQ, IRET &#125; : valA;</span><br><span class="line">	<span class="comment"># Other instructions don&#x27;t need address</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Select memory input data</span></span><br><span class="line">word mem_data = [</span><br><span class="line">	<span class="comment"># Value from register</span></span><br><span class="line">	icode <span class="keyword">in</span> &#123; IRMMOVQ, IPUSHQ &#125; : valA;</span><br><span class="line">	<span class="comment"># Return PC</span></span><br><span class="line">	icode == ICALL : valP;</span><br><span class="line">	<span class="comment"># Default: Don&#x27;t write anything</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Determine instruction status</span></span><br><span class="line">word Stat = [</span><br><span class="line">	imem_error || dmem_error : SADR;</span><br><span class="line">	!instr_valid: SINS;</span><br><span class="line">	icode == IHALT : SHLT;</span><br><span class="line">	<span class="number">1</span> : SAOK;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">################ Program Counter Update ############################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## What address should instruction be fetched at</span></span><br><span class="line"></span><br><span class="line">word new_pc = [</span><br><span class="line">	<span class="comment"># Call.  Use instruction constant</span></span><br><span class="line">	icode == ICALL : valC;</span><br><span class="line">	<span class="comment"># Taken branch.  Use instruction constant</span></span><br><span class="line">	icode == IJXX &amp;&amp; Cnd : valC;</span><br><span class="line">	<span class="comment"># Completion of RET instruction.  Use value from stack</span></span><br><span class="line">	icode == IRET : valM;</span><br><span class="line">	<span class="comment"># Default: Use incremented PC</span></span><br><span class="line">	<span class="number">1</span> : valP;</span><br><span class="line">];</span><br><span class="line"><span class="comment">#/* $end seq-all-hcl */</span></span><br></pre></td></tr></table></figure>
<h5 id="Simple-y86-test"><a href="#Simple-y86-test" class="headerlink" title="Simple y86 test"></a>Simple y86 test</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ make VERSION=full</span><br><span class="line">34 instructions executed</span><br><span class="line">Status = HLT</span><br><span class="line">Condition Codes: Z=1 S=0 O=0</span><br><span class="line">Changed Register State:</span><br><span class="line">%rax:	0x0000000000000000	0x0000abcdabcdabcd</span><br><span class="line">%rsp:	0x0000000000000000	0x0000000000000200</span><br><span class="line">%rdi:	0x0000000000000000	0x0000000000000038</span><br><span class="line">%r8:	0x0000000000000000	0x0000000000000008</span><br><span class="line">%r9:	0x0000000000000000	0x0000000000000001</span><br><span class="line">%r10:	0x0000000000000000	0x0000a000a000a000</span><br><span class="line">Changed Memory State:</span><br><span class="line">0x01f0:	0x0000000000000000	0x0000000000000055</span><br><span class="line">0x01f8:	0x0000000000000000	0x0000000000000013</span><br><span class="line">ISA Check Succeeds</span><br></pre></td></tr></table></figure>
<h5 id="Benchmark-test"><a href="#Benchmark-test" class="headerlink" title="Benchmark test"></a>Benchmark test</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../y86_code ; make testssim</span><br><span class="line">grep <span class="string">&quot;ISA Check&quot;</span> *.seq</span><br><span class="line">asum.seq:ISA Check Succeeds</span><br><span class="line">asumr.seq:ISA Check Succeeds</span><br><span class="line">cjr.seq:ISA Check Succeeds</span><br><span class="line">j-cc.seq:ISA Check Succeeds</span><br><span class="line">poptest.seq:ISA Check Succeeds</span><br><span class="line">prog1.seq:ISA Check Succeeds</span><br><span class="line">prog2.seq:ISA Check Succeeds</span><br><span class="line">prog3.seq:ISA Check Succeeds</span><br><span class="line">prog4.seq:ISA Check Succeeds</span><br><span class="line">prog5.seq:ISA Check Succeeds</span><br><span class="line">prog6.seq:ISA Check Succeeds</span><br><span class="line">prog7.seq:ISA Check Succeeds</span><br><span class="line">prog8.seq:ISA Check Succeeds</span><br><span class="line">pushquestion.seq:ISA Check Succeeds</span><br><span class="line">pushtest.seq:ISA Check Succeeds</span><br><span class="line">ret-hazard.seq:ISA Check Succeeds</span><br></pre></td></tr></table></figure>
<h5 id="Regression-test"><a href="#Regression-test" class="headerlink" title="Regression test"></a>Regression test</h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../ptest; make SIM=../seq/ssim</span><br><span class="line">./optest.pl -s ../seq/ssim </span><br><span class="line">Simulating with ../seq/ssim</span><br><span class="line">  All 49 ISA Checks Succeed</span><br><span class="line">./jtest.pl -s ../seq/ssim </span><br><span class="line">Simulating with ../seq/ssim</span><br><span class="line">  All 64 ISA Checks Succeed</span><br><span class="line">./ctest.pl -s ../seq/ssim </span><br><span class="line">Simulating with ../seq/ssim</span><br><span class="line">  All 22 ISA Checks Succeed</span><br><span class="line">./htest.pl -s ../seq/ssim </span><br><span class="line">Simulating with ../seq/ssim</span><br><span class="line">  All 600 ISA Checks Succeed</span><br></pre></td></tr></table></figure>
<h5 id="Test-iaddq"><a href="#Test-iaddq" class="headerlink" title="Test iaddq"></a>Test <code>iaddq</code></h5><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../ptest; make SIM=../seq/ssim TFLAGS=-i</span><br><span class="line">./optest.pl -s ../seq/ssim -i</span><br><span class="line">Simulating with ../seq/ssim</span><br><span class="line">  All 58 ISA Checks Succeed</span><br><span class="line">./jtest.pl -s ../seq/ssim -i</span><br><span class="line">Simulating with ../seq/ssim</span><br><span class="line">  All 96 ISA Checks Succeed</span><br><span class="line">./ctest.pl -s ../seq/ssim -i</span><br><span class="line">Simulating with ../seq/ssim</span><br><span class="line">  All 22 ISA Checks Succeed</span><br><span class="line">./htest.pl -s ../seq/ssim -i</span><br><span class="line">Simulating with ../seq/ssim</span><br><span class="line">  All 756 ISA Checks Succeed</span><br></pre></td></tr></table></figure>
<h2 id="Part-C"><a href="#Part-C" class="headerlink" title="Part C"></a>Part C</h2><p><em>You will be working in directory <code>sim/pipe</code> in this part.</em></p>
<p>Your task in Part C is to modify <code>ncopy.ys</code> and <code>pipe-full.hcl</code> with the goal of making <code>ncopy.ys</code> <strong>run as fast as possible</strong>.</p>
<h3 id="Coding-rules"><a href="#Coding-rules" class="headerlink" title="Coding rules"></a>Coding rules</h3><p>You are free to make any modifications you wish, with the following constraints:</p>
<ul>
<li><p>Your <code>ncopy.ys</code> function must work for arbitrary array sizes.</p>
</li>
<li><p>Your <code>ncopy.ys</code> function must run correctly with YIS</p>
</li>
<li><p>The assembled version of your ncopy file must not be more than 1000 bytes long</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># length check</span></span><br><span class="line">$ ./check-len.pl &lt; ncopy.yo</span><br></pre></td></tr></table></figure></li>
<li><p>Your <code>pipe-full.hcl</code> implementation must pass the regression tests in <code>../y86-code</code>and <code>../ptest</code>(without the <code>-i</code> flag that tests <code>iaddq</code>)</p>
</li>
</ul>
<p>Other than that, you are free to implement the <code>iaddq</code> instruction if you think that will help. </p>
<p>You may make any semantics preserving transformations to the <code>ncopy.ys</code> function, such as <strong>reordering instructions, replacing groups of instructions with single instructions, deleting some instructions, and adding other instructions</strong></p>
<p>(You may find it useful to read about loop unrolling in Section 5.8 )(Unfortunately, I haven’t progressed to Chapter 5)</p>
<h3 id="Building-and-Running-Your-Solution"><a href="#Building-and-Running-Your-Solution" class="headerlink" title="Building and Running Your Solution"></a>Building and Running Your Solution</h3><p>Each time you modify your ncopy.ys program, you can rebuild the driver programs by typing</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make drivers</span><br></pre></td></tr></table></figure>
<p>Each time you modify your pipe-full.hcl file, you can rebuild the simulator by typing</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make psim VERSION=full</span><br></pre></td></tr></table></figure>
<p>If you want to rebuild the simulator and the driver programs, type</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ make VERSION=full</span><br></pre></td></tr></table></figure>
<hr>
<p><em>Testing your driver files on the ISA simulator.</em> Make sure that your ncopy.ys function works prop- erly with YIS:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ make drivers</span><br><span class="line">$ ../misc/yis sdriver.yo</span><br></pre></td></tr></table></figure>
<p><em>Testing your code on a range of block lengths with the ISA simulator</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./correctness.pl</span><br></pre></td></tr></table></figure>
<p>The program will end with register <code>%rax</code> having the following value:</p>
<p><strong>0xaaaa</strong> : All tests pass.</p>
<p><strong>0xbbbb</strong> : Incorrect count</p>
<p><strong>0xcccc</strong> : Function ncopy is more than 1000 bytes long.</p>
<p><strong>0xdddd</strong> : Some of the source data was not copied to its destination.</p>
<p><strong>0xeeee</strong> : Some word just before or just after the destination region was corrupted.</p>
<p><em>Testing your pipeline simulator on the benchmark programs.</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ (<span class="built_in">cd</span> ../y86-code; make testpsim)</span><br></pre></td></tr></table></figure>
<p><em>Testing your pipeline simulator with extensive regression tests</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ (<span class="built_in">cd</span> ../ptest; make SIM=../pipe/psim TFLAGS=-i)</span><br></pre></td></tr></table></figure>
<p><em>Testing your code on a range of block lengths with the pipeline simulator.</em></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./correctness.pl -p</span><br></pre></td></tr></table></figure>
<h4 id="My-solution-4"><a href="#My-solution-4" class="headerlink" title="My solution :"></a>My solution :</h4><p>For <code>ncopy.ys</code>, I use conditional move to erase the small branch.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">##################################################################</span><br><span class="line"># You can modify this portion</span><br><span class="line">	# Loop header</span><br><span class="line">        irmovq $1,%r11</span><br><span class="line">	xorq %rax,%rax		# count &#x3D; 0;</span><br><span class="line">	andq %rdx,%rdx		# len &lt;&#x3D; 0?</span><br><span class="line">	jle Done		# if so, goto Done:</span><br><span class="line"></span><br><span class="line">Loop:	mrmovq (%rdi), %r10	# read val from src...</span><br><span class="line">	rmmovq %r10, (%rsi)	# ...and store it to dst</span><br><span class="line">        xorq %r8,%r8</span><br><span class="line">	andq %r10, %r10		# val &lt;&#x3D; 0?</span><br><span class="line">        cmovg %r11,%r8</span><br><span class="line">	addq %r8, %rax		# count++</span><br><span class="line">        iaddq $-1,%rdx</span><br><span class="line">        iaddq $8,%rdi</span><br><span class="line">        iaddq $8,%rsi</span><br><span class="line">	andq %rdx,%rdx		# len &gt; 0?</span><br><span class="line">	jg Loop			# if so, goto Loop:</span><br><span class="line">##################################################################</span><br></pre></td></tr></table></figure>
<p>For <code>pipe-full.hcl</code>, I implement the <code>iaddq</code> instruction to reduce the number of instructions in <code>ncopy.ys</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment">#    Control Signal Definitions.                                   #</span></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################ Fetch Stage     ###################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## What address should instruction be fetched at</span></span><br><span class="line">word f_pc = [</span><br><span class="line">	<span class="comment"># Mispredicted branch.  Fetch at incremented PC</span></span><br><span class="line">	M_icode == IJXX &amp;&amp; !M_Cnd : M_valA;</span><br><span class="line">	<span class="comment"># Completion of RET instruction</span></span><br><span class="line">	W_icode == IRET : W_valM;</span><br><span class="line">	<span class="comment"># Default: Use predicted value of PC</span></span><br><span class="line">	<span class="number">1</span> : F_predPC;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Determine icode of fetched instruction</span></span><br><span class="line">word f_icode = [</span><br><span class="line">	imem_error : INOP;</span><br><span class="line">	<span class="number">1</span>: imem_icode;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment"># Determine ifun</span></span><br><span class="line">word f_ifun = [</span><br><span class="line">	imem_error : FNONE;</span><br><span class="line">	<span class="number">1</span>: imem_ifun;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment"># Is instruction valid?</span></span><br><span class="line"><span class="built_in">bool</span> instr_valid = f_icode <span class="keyword">in</span> </span><br><span class="line">	&#123; INOP, IHALT, IRRMOVQ, IIRMOVQ, IRMMOVQ, IMRMOVQ,</span><br><span class="line">	  IOPQ, IJXX, ICALL, IRET, IPUSHQ, IPOPQ  , IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Determine status code for fetched instruction</span></span><br><span class="line">word f_stat = [</span><br><span class="line">	imem_error: SADR;</span><br><span class="line">	!instr_valid : SINS;</span><br><span class="line">	f_icode == IHALT : SHLT;</span><br><span class="line">	<span class="number">1</span> : SAOK;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment"># Does fetched instruction require a regid byte?</span></span><br><span class="line"><span class="built_in">bool</span> need_regids =</span><br><span class="line">	f_icode <span class="keyword">in</span> &#123; IRRMOVQ, IOPQ, IPUSHQ, IPOPQ, </span><br><span class="line">		     IIRMOVQ, IRMMOVQ, IMRMOVQ  , IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Does fetched instruction require a constant word?</span></span><br><span class="line"><span class="built_in">bool</span> need_valC =</span><br><span class="line">	f_icode <span class="keyword">in</span> &#123; IIRMOVQ, IRMMOVQ, IMRMOVQ, IJXX, ICALL  , IIADDQ &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Predict next value of PC</span></span><br><span class="line">word f_predPC = [</span><br><span class="line">	f_icode <span class="keyword">in</span> &#123; IJXX, ICALL &#125; : f_valC;</span><br><span class="line">	<span class="number">1</span> : f_valP;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">################ Decode Stage ######################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## What register should be used as the A source?</span></span><br><span class="line">word d_srcA = [</span><br><span class="line">	D_icode <span class="keyword">in</span> &#123; IRRMOVQ, IRMMOVQ, IOPQ, IPUSHQ  &#125; : D_rA;</span><br><span class="line">	D_icode <span class="keyword">in</span> &#123; IPOPQ, IRET &#125; : RRSP;</span><br><span class="line">	<span class="number">1</span> : RNONE; <span class="comment"># Don&#x27;t need register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## What register should be used as the B source?</span></span><br><span class="line">word d_srcB = [</span><br><span class="line">	D_icode <span class="keyword">in</span> &#123; IOPQ, IRMMOVQ, IMRMOVQ , IIADDQ  &#125; : D_rB;</span><br><span class="line">	D_icode <span class="keyword">in</span> &#123; IPUSHQ, IPOPQ, ICALL, IRET &#125; : RRSP;</span><br><span class="line">	<span class="number">1</span> : RNONE;  <span class="comment"># Don&#x27;t need register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## What register should be used as the E destination?</span></span><br><span class="line">word d_dstE = [</span><br><span class="line">	D_icode <span class="keyword">in</span> &#123; IRRMOVQ, IIRMOVQ, IOPQ , IIADDQ &#125; : D_rB;</span><br><span class="line">	D_icode <span class="keyword">in</span> &#123; IPUSHQ, IPOPQ, ICALL, IRET &#125; : RRSP;</span><br><span class="line">	<span class="number">1</span> : RNONE;  <span class="comment"># Don&#x27;t write any register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## What register should be used as the M destination?</span></span><br><span class="line">word d_dstM = [</span><br><span class="line">	D_icode <span class="keyword">in</span> &#123; IMRMOVQ, IPOPQ &#125; : D_rA;</span><br><span class="line">	<span class="number">1</span> : RNONE;  <span class="comment"># Don&#x27;t write any register</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## What should be the A value?</span></span><br><span class="line"><span class="comment">## Forward into decode stage for valA</span></span><br><span class="line">word d_valA = [</span><br><span class="line">	D_icode <span class="keyword">in</span> &#123; ICALL, IJXX &#125; : D_valP; <span class="comment"># Use incremented PC</span></span><br><span class="line">	d_srcA == e_dstE : e_valE;    <span class="comment"># Forward valE from execute</span></span><br><span class="line">	d_srcA == M_dstM : m_valM;    <span class="comment"># Forward valM from memory</span></span><br><span class="line">	d_srcA == M_dstE : M_valE;    <span class="comment"># Forward valE from memory</span></span><br><span class="line">	d_srcA == W_dstM : W_valM;    <span class="comment"># Forward valM from write back</span></span><br><span class="line">	d_srcA == W_dstE : W_valE;    <span class="comment"># Forward valE from write back</span></span><br><span class="line">	<span class="number">1</span> : d_rvalA;  <span class="comment"># Use value read from register file</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line">word d_valB = [</span><br><span class="line">	d_srcB == e_dstE : e_valE;    <span class="comment"># Forward valE from execute</span></span><br><span class="line">	d_srcB == M_dstM : m_valM;    <span class="comment"># Forward valM from memory</span></span><br><span class="line">	d_srcB == M_dstE : M_valE;    <span class="comment"># Forward valE from memory</span></span><br><span class="line">	d_srcB == W_dstM : W_valM;    <span class="comment"># Forward valM from write back</span></span><br><span class="line">	d_srcB == W_dstE : W_valE;    <span class="comment"># Forward valE from write back</span></span><br><span class="line">	<span class="number">1</span> : d_rvalB;  <span class="comment"># Use value read from register file</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">################ Execute Stage #####################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Select input A to ALU</span></span><br><span class="line">word aluA = [</span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; IRRMOVQ, IOPQ &#125; : E_valA;</span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; IIRMOVQ, IRMMOVQ, IMRMOVQ , IIADDQ &#125; : E_valC;</span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; ICALL, IPUSHQ &#125; : -<span class="number">8</span>;</span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; IRET, IPOPQ &#125; : <span class="number">8</span>;</span><br><span class="line">	<span class="comment"># Other instructions don&#x27;t need ALU</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Select input B to ALU</span></span><br><span class="line">word aluB = [</span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; IRMMOVQ, IMRMOVQ, IOPQ, ICALL, </span><br><span class="line">		     IPUSHQ, IRET, IPOPQ , IIADDQ &#125; : E_valB;</span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; IRRMOVQ, IIRMOVQ &#125; : <span class="number">0</span>;</span><br><span class="line">	<span class="comment"># Other instructions don&#x27;t need ALU</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set the ALU function</span></span><br><span class="line">word alufun = [</span><br><span class="line">	E_icode == IOPQ : E_ifun;</span><br><span class="line">	<span class="number">1</span> : ALUADD;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Should the condition codes be updated?</span></span><br><span class="line"><span class="built_in">bool</span> set_cc = E_icode <span class="keyword">in</span> &#123;IOPQ , IIADDQ &#125;  &amp;&amp;</span><br><span class="line">	<span class="comment"># State changes only during normal operation</span></span><br><span class="line">	!m_stat <span class="keyword">in</span> &#123; SADR, SINS, SHLT &#125; &amp;&amp; !W_stat <span class="keyword">in</span> &#123; SADR, SINS, SHLT &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Generate valA in execute stage</span></span><br><span class="line">word e_valA = E_valA;    <span class="comment"># Pass valA through stage</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Set dstE to RNONE in event of not-taken conditional move</span></span><br><span class="line">word e_dstE = [</span><br><span class="line">	E_icode == IRRMOVQ &amp;&amp; !e_Cnd : RNONE;</span><br><span class="line">	<span class="number">1</span> : E_dstE;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">################ Memory Stage ######################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Select memory address</span></span><br><span class="line">word mem_addr = [</span><br><span class="line">	M_icode <span class="keyword">in</span> &#123; IRMMOVQ, IPUSHQ, ICALL, IMRMOVQ &#125; : M_valE;</span><br><span class="line">	M_icode <span class="keyword">in</span> &#123; IPOPQ, IRET &#125; : M_valA;</span><br><span class="line">	<span class="comment"># Other instructions don&#x27;t need address</span></span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set read control signal</span></span><br><span class="line"><span class="built_in">bool</span> mem_read = M_icode <span class="keyword">in</span> &#123; IMRMOVQ, IPOPQ, IRET &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set write control signal</span></span><br><span class="line"><span class="built_in">bool</span> mem_write = M_icode <span class="keyword">in</span> &#123; IRMMOVQ, IPUSHQ, ICALL &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">#/* $begin pipe-m_stat-hcl */</span></span><br><span class="line"><span class="comment">## Update the status</span></span><br><span class="line">word m_stat = [</span><br><span class="line">	dmem_error : SADR;</span><br><span class="line">	<span class="number">1</span> : M_stat;</span><br><span class="line">];</span><br><span class="line"><span class="comment">#/* $end pipe-m_stat-hcl */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">## Set E port register ID</span></span><br><span class="line">word w_dstE = W_dstE;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set E port value</span></span><br><span class="line">word w_valE = W_valE;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set M port register ID</span></span><br><span class="line">word w_dstM = W_dstM;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Set M port value</span></span><br><span class="line">word w_valM = W_valM;</span><br><span class="line"></span><br><span class="line"><span class="comment">## Update processor status</span></span><br><span class="line">word Stat = [</span><br><span class="line">	W_stat == SBUB : SAOK;</span><br><span class="line">	<span class="number">1</span> : W_stat;</span><br><span class="line">];</span><br><span class="line"></span><br><span class="line"><span class="comment">################ Pipeline Register Control #########################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Should I stall or inject a bubble into Pipeline Register F?</span></span><br><span class="line"><span class="comment"># At most one of these can be true.</span></span><br><span class="line"><span class="built_in">bool</span> F_bubble = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">bool</span> F_stall =</span><br><span class="line">	<span class="comment"># Conditions for a load/use hazard</span></span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; IMRMOVQ, IPOPQ &#125; &amp;&amp;</span><br><span class="line">	 E_dstM <span class="keyword">in</span> &#123; d_srcA, d_srcB &#125; ||</span><br><span class="line">	<span class="comment"># Stalling at fetch while ret passes through pipeline</span></span><br><span class="line">	IRET <span class="keyword">in</span> &#123; D_icode, E_icode, M_icode &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Should I stall or inject a bubble into Pipeline Register D?</span></span><br><span class="line"><span class="comment"># At most one of these can be true.</span></span><br><span class="line"><span class="built_in">bool</span> D_stall = </span><br><span class="line">	<span class="comment"># Conditions for a load/use hazard</span></span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; IMRMOVQ, IPOPQ &#125; &amp;&amp;</span><br><span class="line">	 E_dstM <span class="keyword">in</span> &#123; d_srcA, d_srcB &#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">bool</span> D_bubble =</span><br><span class="line">	<span class="comment"># Mispredicted branch</span></span><br><span class="line">	(E_icode == IJXX &amp;&amp; !e_Cnd) ||</span><br><span class="line">	<span class="comment"># Stalling at fetch while ret passes through pipeline</span></span><br><span class="line">	<span class="comment"># but not condition for a load/use hazard</span></span><br><span class="line">	!(E_icode <span class="keyword">in</span> &#123; IMRMOVQ, IPOPQ &#125; &amp;&amp; E_dstM <span class="keyword">in</span> &#123; d_srcA, d_srcB &#125;) &amp;&amp;</span><br><span class="line">	  IRET <span class="keyword">in</span> &#123; D_icode, E_icode, M_icode &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Should I stall or inject a bubble into Pipeline Register E?</span></span><br><span class="line"><span class="comment"># At most one of these can be true.</span></span><br><span class="line"><span class="built_in">bool</span> E_stall = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">bool</span> E_bubble =</span><br><span class="line">	<span class="comment"># Mispredicted branch</span></span><br><span class="line">	(E_icode == IJXX &amp;&amp; !e_Cnd) ||</span><br><span class="line">	<span class="comment"># Conditions for a load/use hazard</span></span><br><span class="line">	E_icode <span class="keyword">in</span> &#123; IMRMOVQ, IPOPQ &#125; &amp;&amp;</span><br><span class="line">	 E_dstM <span class="keyword">in</span> &#123; d_srcA, d_srcB&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Should I stall or inject a bubble into Pipeline Register M?</span></span><br><span class="line"><span class="comment"># At most one of these can be true.</span></span><br><span class="line"><span class="built_in">bool</span> M_stall = <span class="number">0</span>;</span><br><span class="line"><span class="comment"># Start injecting bubbles as soon as exception passes through memory stage</span></span><br><span class="line"><span class="built_in">bool</span> M_bubble = m_stat <span class="keyword">in</span> &#123; SADR, SINS, SHLT &#125; || W_stat <span class="keyword">in</span> &#123; SADR, SINS, SHLT &#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Should I stall or inject a bubble into Pipeline Register W?</span></span><br><span class="line"><span class="built_in">bool</span> W_stall = W_stat <span class="keyword">in</span> &#123; SADR, SINS, SHLT &#125;;</span><br><span class="line"><span class="built_in">bool</span> W_bubble = <span class="number">0</span>;</span><br><span class="line"><span class="comment">#/* $end pipe-all-hcl */</span></span><br></pre></td></tr></table></figure>
<p>Again, we only need to do little modification to the codes, all complex stuff such as data forwarding, bubble injection and PC predication for <code>ret</code> and <code>call</code>, which I don’t quite understand, are done by the teachers.</p>
<p>By the way, don’t forget that <code>iaddq</code> need to set the condition code.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test ncopy.ys</span></span><br><span class="line">$ ./correctness.pl</span><br><span class="line">Simulating with instruction <span class="built_in">set</span> simulator yis</span><br><span class="line">	ncopy</span><br><span class="line">0	OK</span><br><span class="line">1	OK</span><br><span class="line">2	OK</span><br><span class="line">3	OK</span><br><span class="line">4	OK</span><br><span class="line">5	OK</span><br><span class="line">6	OK</span><br><span class="line">7	OK</span><br><span class="line">8	OK</span><br><span class="line">9	OK</span><br><span class="line">10	OK</span><br><span class="line">11	OK</span><br><span class="line">12	OK</span><br><span class="line">13	OK</span><br><span class="line">14	OK</span><br><span class="line">15	OK</span><br><span class="line">16	OK</span><br><span class="line">17	OK</span><br><span class="line">18	OK</span><br><span class="line">19	OK</span><br><span class="line">20	OK</span><br><span class="line">21	OK</span><br><span class="line">22	OK</span><br><span class="line">23	OK</span><br><span class="line">24	OK</span><br><span class="line">25	OK</span><br><span class="line">26	OK</span><br><span class="line">27	OK</span><br><span class="line">28	OK</span><br><span class="line">29	OK</span><br><span class="line">30	OK</span><br><span class="line">31	OK</span><br><span class="line">32	OK</span><br><span class="line">33	OK</span><br><span class="line">34	OK</span><br><span class="line">35	OK</span><br><span class="line">36	OK</span><br><span class="line">37	OK</span><br><span class="line">38	OK</span><br><span class="line">39	OK</span><br><span class="line">40	OK</span><br><span class="line">41	OK</span><br><span class="line">42	OK</span><br><span class="line">43	OK</span><br><span class="line">44	OK</span><br><span class="line">45	OK</span><br><span class="line">46	OK</span><br><span class="line">47	OK</span><br><span class="line">48	OK</span><br><span class="line">49	OK</span><br><span class="line">50	OK</span><br><span class="line">51	OK</span><br><span class="line">52	OK</span><br><span class="line">53	OK</span><br><span class="line">54	OK</span><br><span class="line">55	OK</span><br><span class="line">56	OK</span><br><span class="line">57	OK</span><br><span class="line">58	OK</span><br><span class="line">59	OK</span><br><span class="line">60	OK</span><br><span class="line">61	OK</span><br><span class="line">62	OK</span><br><span class="line">63	OK</span><br><span class="line">64	OK</span><br><span class="line">128	OK</span><br><span class="line">192	OK</span><br><span class="line">256	OK</span><br><span class="line">68/68 pass correctness <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test benchmark programs on modified psim</span></span><br><span class="line">$ (<span class="built_in">cd</span> ../y86-code; make testpsim)</span><br><span class="line">grep <span class="string">&quot;ISA Check&quot;</span> *.pipe</span><br><span class="line">asum.pipe:ISA Check Succeeds</span><br><span class="line">asumr.pipe:ISA Check Succeeds</span><br><span class="line">cjr.pipe:ISA Check Succeeds</span><br><span class="line">j-cc.pipe:ISA Check Succeeds</span><br><span class="line">poptest.pipe:ISA Check Succeeds</span><br><span class="line">prog1.pipe:ISA Check Succeeds</span><br><span class="line">prog2.pipe:ISA Check Succeeds</span><br><span class="line">prog3.pipe:ISA Check Succeeds</span><br><span class="line">prog4.pipe:ISA Check Succeeds</span><br><span class="line">prog5.pipe:ISA Check Succeeds</span><br><span class="line">prog6.pipe:ISA Check Succeeds</span><br><span class="line">prog7.pipe:ISA Check Succeeds</span><br><span class="line">prog8.pipe:ISA Check Succeeds</span><br><span class="line">pushquestion.pipe:ISA Check Succeeds</span><br><span class="line">pushtest.pipe:ISA Check Succeeds</span><br><span class="line">ret-hazard.pipe:ISA Check Succeeds</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test with extensive regression tests</span></span><br><span class="line">$ (<span class="built_in">cd</span> ../ptest; make SIM=../pipe/psim TFLAGS=-i)</span><br><span class="line">./optest.pl -s ../pipe/psim -i</span><br><span class="line">Simulating with ../pipe/psim</span><br><span class="line">  All 58 ISA Checks Succeed</span><br><span class="line">./jtest.pl -s ../pipe/psim -i</span><br><span class="line">Simulating with ../pipe/psim</span><br><span class="line">  All 96 ISA Checks Succeed</span><br><span class="line">./ctest.pl -s ../pipe/psim -i</span><br><span class="line">Simulating with ../pipe/psim</span><br><span class="line">  All 22 ISA Checks Succeed</span><br><span class="line">./htest.pl -s ../pipe/psim -i</span><br><span class="line">Simulating with ../pipe/psim</span><br><span class="line">  All 756 ISA Checks Succeed</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># test correctness on modified pipeline</span></span><br><span class="line">$ ./correctness.pl -p</span><br><span class="line">Simulating with pipeline simulator psim</span><br><span class="line">	ncopy</span><br><span class="line">0	OK</span><br><span class="line">1	OK</span><br><span class="line">2	OK</span><br><span class="line">3	OK</span><br><span class="line">4	OK</span><br><span class="line">5	OK</span><br><span class="line">6	OK</span><br><span class="line">7	OK</span><br><span class="line">8	OK</span><br><span class="line">9	OK</span><br><span class="line">10	OK</span><br><span class="line">11	OK</span><br><span class="line">12	OK</span><br><span class="line">13	OK</span><br><span class="line">14	OK</span><br><span class="line">15	OK</span><br><span class="line">16	OK</span><br><span class="line">17	OK</span><br><span class="line">18	OK</span><br><span class="line">19	OK</span><br><span class="line">20	OK</span><br><span class="line">21	OK</span><br><span class="line">22	OK</span><br><span class="line">23	OK</span><br><span class="line">24	OK</span><br><span class="line">25	OK</span><br><span class="line">26	OK</span><br><span class="line">27	OK</span><br><span class="line">28	OK</span><br><span class="line">29	OK</span><br><span class="line">30	OK</span><br><span class="line">31	OK</span><br><span class="line">32	OK</span><br><span class="line">33	OK</span><br><span class="line">34	OK</span><br><span class="line">35	OK</span><br><span class="line">36	OK</span><br><span class="line">37	OK</span><br><span class="line">38	OK</span><br><span class="line">39	OK</span><br><span class="line">40	OK</span><br><span class="line">41	OK</span><br><span class="line">42	OK</span><br><span class="line">43	OK</span><br><span class="line">44	OK</span><br><span class="line">45	OK</span><br><span class="line">46	OK</span><br><span class="line">47	OK</span><br><span class="line">48	OK</span><br><span class="line">49	OK</span><br><span class="line">50	OK</span><br><span class="line">51	OK</span><br><span class="line">52	OK</span><br><span class="line">53	OK</span><br><span class="line">54	OK</span><br><span class="line">55	OK</span><br><span class="line">56	OK</span><br><span class="line">57	OK</span><br><span class="line">58	OK</span><br><span class="line">59	OK</span><br><span class="line">60	OK</span><br><span class="line">61	OK</span><br><span class="line">62	OK</span><br><span class="line">63	OK</span><br><span class="line">64	OK</span><br><span class="line">128	OK</span><br><span class="line">192	OK</span><br><span class="line">256	OK</span><br><span class="line">68/68 pass correctness <span class="built_in">test</span></span><br></pre></td></tr></table></figure>
<h2 id="Evaluation"><a href="#Evaluation" class="headerlink" title="Evaluation"></a>Evaluation</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">$ ./benchmark.pl</span><br><span class="line">	ncopy</span><br><span class="line">0	14</span><br><span class="line">1	30	30.00</span><br><span class="line">2	42	21.00</span><br><span class="line">3	54	18.00</span><br><span class="line">4	66	16.50</span><br><span class="line">5	78	15.60</span><br><span class="line">6	90	15.00</span><br><span class="line">7	102	14.57</span><br><span class="line">8	114	14.25</span><br><span class="line">9	126	14.00</span><br><span class="line">10	138	13.80</span><br><span class="line">11	150	13.64</span><br><span class="line">12	162	13.50</span><br><span class="line">13	174	13.38</span><br><span class="line">14	186	13.29</span><br><span class="line">15	198	13.20</span><br><span class="line">16	210	13.12</span><br><span class="line">17	222	13.06</span><br><span class="line">18	234	13.00</span><br><span class="line">19	246	12.95</span><br><span class="line">20	258	12.90</span><br><span class="line">21	270	12.86</span><br><span class="line">22	282	12.82</span><br><span class="line">23	294	12.78</span><br><span class="line">24	306	12.75</span><br><span class="line">25	318	12.72</span><br><span class="line">26	330	12.69</span><br><span class="line">27	342	12.67</span><br><span class="line">28	354	12.64</span><br><span class="line">29	366	12.62</span><br><span class="line">30	378	12.60</span><br><span class="line">31	390	12.58</span><br><span class="line">32	402	12.56</span><br><span class="line">33	414	12.55</span><br><span class="line">34	426	12.53</span><br><span class="line">35	438	12.51</span><br><span class="line">36	450	12.50</span><br><span class="line">37	462	12.49</span><br><span class="line">38	474	12.47</span><br><span class="line">39	486	12.46</span><br><span class="line">40	498	12.45</span><br><span class="line">41	510	12.44</span><br><span class="line">42	522	12.43</span><br><span class="line">43	534	12.42</span><br><span class="line">44	546	12.41</span><br><span class="line">45	558	12.40</span><br><span class="line">46	570	12.39</span><br><span class="line">47	582	12.38</span><br><span class="line">48	594	12.38</span><br><span class="line">49	606	12.37</span><br><span class="line">50	618	12.36</span><br><span class="line">51	630	12.35</span><br><span class="line">52	642	12.35</span><br><span class="line">53	654	12.34</span><br><span class="line">54	666	12.33</span><br><span class="line">55	678	12.33</span><br><span class="line">56	690	12.32</span><br><span class="line">57	702	12.32</span><br><span class="line">58	714	12.31</span><br><span class="line">59	726	12.31</span><br><span class="line">60	738	12.30</span><br><span class="line">61	750	12.30</span><br><span class="line">62	762	12.29</span><br><span class="line">63	774	12.29</span><br><span class="line">64	786	12.28</span><br><span class="line">Average CPE	13.33</span><br><span class="line">Score	0.0/60.0</span><br></pre></td></tr></table></figure>
<p>I know there are many tricks to accelerate the program, such as expanding the loop, using different branch predication strategies and implementing data forwarding in <code>pipe-lf.hcl</code>. But I failed to figure the implementation on my own. Thanks for <a target="_blank" rel="noopener" href="https://dreamanddead.github.io/CSAPP-3e-Solutions/chapter4/4.57/">dreamanddead</a>.</p>
<p>However, it only gives me 1 second reduction…..</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">$ ./benchmark.pl</span><br><span class="line">	ncopy</span><br><span class="line">0	14</span><br><span class="line">1	29	29.00</span><br><span class="line">2	40	20.00</span><br><span class="line">3	51	17.00</span><br><span class="line">4	62	15.50</span><br><span class="line">5	73	14.60</span><br><span class="line">6	84	14.00</span><br><span class="line">7	95	13.57</span><br><span class="line">8	106	13.25</span><br><span class="line">9	117	13.00</span><br><span class="line">10	128	12.80</span><br><span class="line">11	139	12.64</span><br><span class="line">12	150	12.50</span><br><span class="line">13	161	12.38</span><br><span class="line">14	172	12.29</span><br><span class="line">15	183	12.20</span><br><span class="line">16	194	12.12</span><br><span class="line">17	205	12.06</span><br><span class="line">18	216	12.00</span><br><span class="line">19	227	11.95</span><br><span class="line">20	238	11.90</span><br><span class="line">21	249	11.86</span><br><span class="line">22	260	11.82</span><br><span class="line">23	271	11.78</span><br><span class="line">24	282	11.75</span><br><span class="line">25	293	11.72</span><br><span class="line">26	304	11.69</span><br><span class="line">27	315	11.67</span><br><span class="line">28	326	11.64</span><br><span class="line">29	337	11.62</span><br><span class="line">30	348	11.60</span><br><span class="line">31	359	11.58</span><br><span class="line">32	370	11.56</span><br><span class="line">33	381	11.55</span><br><span class="line">34	392	11.53</span><br><span class="line">35	403	11.51</span><br><span class="line">36	414	11.50</span><br><span class="line">37	425	11.49</span><br><span class="line">38	436	11.47</span><br><span class="line">39	447	11.46</span><br><span class="line">40	458	11.45</span><br><span class="line">41	469	11.44</span><br><span class="line">42	480	11.43</span><br><span class="line">43	491	11.42</span><br><span class="line">44	502	11.41</span><br><span class="line">45	513	11.40</span><br><span class="line">46	524	11.39</span><br><span class="line">47	535	11.38</span><br><span class="line">48	546	11.38</span><br><span class="line">49	557	11.37</span><br><span class="line">50	568	11.36</span><br><span class="line">51	579	11.35</span><br><span class="line">52	590	11.35</span><br><span class="line">53	601	11.34</span><br><span class="line">54	612	11.33</span><br><span class="line">55	623	11.33</span><br><span class="line">56	634	11.32</span><br><span class="line">57	645	11.32</span><br><span class="line">58	656	11.31</span><br><span class="line">59	667	11.31</span><br><span class="line">60	678	11.30</span><br><span class="line">61	689	11.30</span><br><span class="line">62	700	11.29</span><br><span class="line">63	711	11.29</span><br><span class="line">64	722	11.28</span><br><span class="line">Average CPE	12.33</span><br><span class="line">Score	0.0/60.0</span><br></pre></td></tr></table></figure>
<p>I have to admit that I failed on Part C.</p>
<p>(In fact, the <code>brenchmark.pl</code> only use output of <code>psim</code> to judge the performance, so wrong implementation will be scored very high, for example, just delete the implementation of <code>iaddq</code>)</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line">	ncopy</span><br><span class="line">0	14</span><br><span class="line">1	19	19.00</span><br><span class="line">2	19	9.50</span><br><span class="line">3	19	6.33</span><br><span class="line">4	19	4.75</span><br><span class="line">5	19	3.80</span><br><span class="line">6	19	3.17</span><br><span class="line">7	19	2.71</span><br><span class="line">8	19	2.38</span><br><span class="line">9	19	2.11</span><br><span class="line">10	19	1.90</span><br><span class="line">11	19	1.73</span><br><span class="line">12	19	1.58</span><br><span class="line">13	19	1.46</span><br><span class="line">14	19	1.36</span><br><span class="line">15	19	1.27</span><br><span class="line">16	19	1.19</span><br><span class="line">17	19	1.12</span><br><span class="line">18	19	1.06</span><br><span class="line">19	19	1.00</span><br><span class="line">20	19	0.95</span><br><span class="line">21	19	0.90</span><br><span class="line">22	19	0.86</span><br><span class="line">23	19	0.83</span><br><span class="line">24	19	0.79</span><br><span class="line">25	19	0.76</span><br><span class="line">26	19	0.73</span><br><span class="line">27	19	0.70</span><br><span class="line">28	19	0.68</span><br><span class="line">29	19	0.66</span><br><span class="line">30	19	0.63</span><br><span class="line">31	19	0.61</span><br><span class="line">32	19	0.59</span><br><span class="line">33	19	0.58</span><br><span class="line">34	19	0.56</span><br><span class="line">35	19	0.54</span><br><span class="line">36	19	0.53</span><br><span class="line">37	19	0.51</span><br><span class="line">38	19	0.50</span><br><span class="line">39	19	0.49</span><br><span class="line">40	19	0.47</span><br><span class="line">41	19	0.46</span><br><span class="line">42	19	0.45</span><br><span class="line">43	19	0.44</span><br><span class="line">44	19	0.43</span><br><span class="line">45	19	0.42</span><br><span class="line">46	19	0.41</span><br><span class="line">47	19	0.40</span><br><span class="line">48	19	0.40</span><br><span class="line">49	19	0.39</span><br><span class="line">50	19	0.38</span><br><span class="line">51	19	0.37</span><br><span class="line">52	19	0.37</span><br><span class="line">53	19	0.36</span><br><span class="line">54	19	0.35</span><br><span class="line">55	19	0.35</span><br><span class="line">56	19	0.34</span><br><span class="line">57	19	0.33</span><br><span class="line">58	19	0.33</span><br><span class="line">59	19	0.32</span><br><span class="line">60	19	0.32</span><br><span class="line">61	19	0.31</span><br><span class="line">62	19	0.31</span><br><span class="line">63	19	0.30</span><br><span class="line">64	19	0.30</span><br><span class="line">Average CPE	1.41</span><br><span class="line">Score	60.0/60.0</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://rubbish-and-world.github.io/2021/09/03/CSAPP/architecturelab/" data-id="clw33pwyq001mrtyq9woj9wps" data-title="architecturelab" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2021/09/04/CSAPP/Ch5/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Ch5
        
      </div>
    </a>
  
  
    <a href="/2021/08/28/CSAPP/Ch4PartII/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Ch4PartII</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Cryptography/">Cryptography</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Data-Structure/">Data Structure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Electronics/">Electronics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/FrontEnd/">FrontEnd</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/FrontEnd/course/">course</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Hexo/">Hexo</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/IOT/">IOT</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/LLL/">LLL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Machine-Learning/">Machine Learning</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Machine-Learning/NTU/">NTU</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Machine-Learning/Stanford-CS229/">Stanford CS229</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/">Math</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Math/Discrete-Mathematics/">Discrete Mathematics</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/Linear-Algebra/">Linear Algebra</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Math/Statistics/">Statistics</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Missing-Semester/">Missing Semester</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Networking/">Networking</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Networking/Stanford-CS144/">Stanford CS144</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/">OS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/OS/30DayOS/">30DayOS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/OS/TEP/">TEP</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Python-OG/">Python OG</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web3/">Web3</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/bis/">bis</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/csapp/">csapp</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/feeling/">feeling</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/feelings/">feelings</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/misc/">misc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/noval/">noval</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/game/" rel="tag">game</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/game/" style="font-size: 10px;">game</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/05/">May 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/02/">February 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/01/">January 2024</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/12/">December 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/08/">August 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/01/">January 2023</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/12/">December 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/11/">November 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/09/">September 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/08/">August 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/07/">July 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/06/">June 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/05/">May 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/04/">April 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/03/">March 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/02/">February 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2022/01/">January 2022</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/12/">December 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/11/">November 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/10/">October 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/09/">September 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/08/">August 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/05/19/feelings/flow/">flow</a>
          </li>
        
          <li>
            <a href="/2024/05/17/feelings/crush/">crush</a>
          </li>
        
          <li>
            <a href="/2024/02/04/Bis/Core/">Core</a>
          </li>
        
          <li>
            <a href="/2024/01/29/miscellaneous/steal-video/">steal-video</a>
          </li>
        
          <li>
            <a href="/2024/01/01/feelings/2024/">2024</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 rubbish<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>